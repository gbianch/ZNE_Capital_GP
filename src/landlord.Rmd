---
title: "landlord"
author: "Virginia Pan"
date: "10/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(googlesheets4)
library(janitor)
library(tidyverse)
library(kableExtra)
library(DT)
library(ggplot2)
library(readxl)
library(here)
source(here("R/normalize.R"))

MSA_landlord_data <- read_sheet("https://docs.google.com/spreadsheets/d/1zCePYRyJ5lb1Z5jvCujg17EtwqpxJN1E1_HwJL66uLM/edit#gid=122953884") 

```


```{r}
#security_deposit_limit
MSA_landlord_data <- MSA_landlord_data %>% 
  mutate(
    security_deposit_limit_num = case_when(
      security_deposit_limit == "N" ~ 1.0, 
      security_deposit_limit == "1_month_rent" ~ 0.0,
      security_deposit_limit == "2_months_rent" ~ 0.5)) %>% 
    #"invert" normalized score for eviction notice days
#1 - normalized score (since more eviction notice is worse for landlords)
  mutate(n_eviction_notice = 1- normalize(eviction_notice_days))

# assign numeric values to security deposit limit for all states
state_landlord_policy <- state_landlord_policy %>% 
  mutate(security_deposit_limit = case_when(
      deposit_limit == "N" ~ 1.0, 
      deposit_limit == "1_months_rent" ~ 0.0,
      deposit_limit == "1_month_rent" ~ 0.0,
      deposit_limit == "1.5_months_rent" ~ 0.25,
      deposit_limit == "2_months_rent" ~ 0.5,
      deposit_limit == "2.5_months_rent" ~ 0.75,
      deposit_limit == "3_months_rent" ~ 0.75)) %>% 
   #"invert" normalized score for eviction notice days
#1 - normalized score (since more eviction notice is worse for landlords)
  mutate(n_eviction_notice = 1- normalize(eviction_days))
  

```

#calculate landlord category score

```{r}

#input landlord weights for each indicator in the following order: eviction notice days, security deposit limit, notice for entry 

#Weights must sum to 1
landlord_weights <- c(0.8, 0.2)

#make landlord_score column
MSA_landlord_data <- MSA_landlord_data %>% 
  mutate(
    landlord_score = MSA #this is just a place holder
  )
size <- dim(MSA_landlord_data)
for (i in 1:size[1]) {
  MSA_x_data <- c(MSA_landlord_data$eviction_notice_days_normalized_inverted[i],
                  MSA_landlord_data$security_depopsit_limit_num[i]
                  )
  MSA_landlord_data$landlord_score[i] = weighted.mean(MSA_x_data, landlord_weights)
}
```

```{r}
#If there is rent control, immediately disqualify location (set score to -999)
for (j in 1:size[1]) {
  if(MSA_landlord_data$rent_control[j] == "Y"){
    MSA_landlord_data$landlord_score[j] = -999
  }
}

```

```{r}
#write result to google sheet
#gs4_create("MSA_landlord_score")
sheet_write(MSA_landlord_data, ss = "https://docs.google.com/spreadsheets/d/1nLpDhM88a3rEBDVK5RZlk2B6QuwVIwvsfE5HeBz0mLo/edit?usp=sharing", sheet = "MSA_landlord_data")
```

